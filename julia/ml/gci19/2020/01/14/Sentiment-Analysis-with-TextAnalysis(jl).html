<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Comparing Sentiment Analysis Models | Madhav’s CS Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Comparing Sentiment Analysis Models" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Part 1 with TextAnalysis.jl Amazon Reviews Dataset" />
<meta property="og:description" content="Part 1 with TextAnalysis.jl Amazon Reviews Dataset" />
<link rel="canonical" href="https://csblog.madhavshekhar.com/julia/ml/gci19/2020/01/14/Sentiment-Analysis-with-TextAnalysis(jl).html" />
<meta property="og:url" content="https://csblog.madhavshekhar.com/julia/ml/gci19/2020/01/14/Sentiment-Analysis-with-TextAnalysis(jl).html" />
<meta property="og:site_name" content="Madhav’s CS Blog" />
<meta property="og:image" content="https://csblog.madhavshekhar.com/images/sent.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-01-14T00:00:00-06:00" />
<script type="application/ld+json">
{"description":"Part 1 with TextAnalysis.jl Amazon Reviews Dataset","@type":"BlogPosting","headline":"Comparing Sentiment Analysis Models","dateModified":"2020-01-14T00:00:00-06:00","datePublished":"2020-01-14T00:00:00-06:00","url":"https://csblog.madhavshekhar.com/julia/ml/gci19/2020/01/14/Sentiment-Analysis-with-TextAnalysis(jl).html","mainEntityOfPage":{"@type":"WebPage","@id":"https://csblog.madhavshekhar.com/julia/ml/gci19/2020/01/14/Sentiment-Analysis-with-TextAnalysis(jl).html"},"image":"https://csblog.madhavshekhar.com/images/sent.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://csblog.madhavshekhar.com/feed.xml" title="Madhav's CS Blog" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Comparing Sentiment Analysis Models | Madhav’s CS Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Comparing Sentiment Analysis Models" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Part 1 with TextAnalysis.jl Amazon Reviews Dataset" />
<meta property="og:description" content="Part 1 with TextAnalysis.jl Amazon Reviews Dataset" />
<link rel="canonical" href="https://csblog.madhavshekhar.com/julia/ml/gci19/2020/01/14/Sentiment-Analysis-with-TextAnalysis(jl).html" />
<meta property="og:url" content="https://csblog.madhavshekhar.com/julia/ml/gci19/2020/01/14/Sentiment-Analysis-with-TextAnalysis(jl).html" />
<meta property="og:site_name" content="Madhav’s CS Blog" />
<meta property="og:image" content="https://csblog.madhavshekhar.com/images/sent.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-01-14T00:00:00-06:00" />
<script type="application/ld+json">
{"description":"Part 1 with TextAnalysis.jl Amazon Reviews Dataset","@type":"BlogPosting","headline":"Comparing Sentiment Analysis Models","dateModified":"2020-01-14T00:00:00-06:00","datePublished":"2020-01-14T00:00:00-06:00","url":"https://csblog.madhavshekhar.com/julia/ml/gci19/2020/01/14/Sentiment-Analysis-with-TextAnalysis(jl).html","mainEntityOfPage":{"@type":"WebPage","@id":"https://csblog.madhavshekhar.com/julia/ml/gci19/2020/01/14/Sentiment-Analysis-with-TextAnalysis(jl).html"},"image":"https://csblog.madhavshekhar.com/images/sent.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://csblog.madhavshekhar.com/feed.xml" title="Madhav's CS Blog" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Madhav&#39;s CS Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Comparing Sentiment Analysis Models</h1><p class="page-description">Part 1 with TextAnalysis.jl | Amazon Reviews Dataset</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-01-14T00:00:00-06:00" itemprop="datePublished">
        Jan 14, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      8 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#julia">julia</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#ml">ml</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#gci19">gci19</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/PseudoCodeNerd/blog/tree/master/_notebooks/2020-01-14-Sentiment-Analysis-with-TextAnalysis(jl).ipynb" role="button">
<img class="notebook-badge-image" src="/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div><div class="px-2">
    <a href="https://colab.research.google.com/github/PseudoCodeNerd/blog/blob/master/_notebooks/2020-01-14-Sentiment-Analysis-with-TextAnalysis(jl).ipynb">
        <img class="notebook-badge-image" src="/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-01-14-Sentiment-Analysis-with-TextAnalysis(jl).ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><div class="flash">
    <svg class="octicon octicon-info octicon octicon-info" viewBox="0 0 14 16" version="1.1" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 01-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 01-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg>
    <strong>Note: </strong>Part 2 of this notebook is accomplished with TensorFlow and can be <a href="https://gist.github.com/PseudoCodeNerd/493a3f477bd97fc15b24c853e7de7d9c">found here.</a>
</div></p>
<h2 id="Task-Description">Task Description<a class="anchor-link" href="#Task-Description"> </a></h2><p>Use the amazon review data from Kaggle to test the efficiency of our Sentiment Analysis models that live in TextAnalysis.jl. Compare it with models in ScikitLearn and Spacy python libraries. Upload your results as an issue in the TextAnalysis package.</p>
<p>Some basic machine learning knowledge is useful for this task.</p>
<h4 id="Special-thanks-to-Ayush-Kaushal;-an-exemplary-mentor-without-whom-this-task-wouldn't-be-possible.">Special thanks to Ayush Kaushal; an exemplary mentor without whom this task wouldn't be possible.<a class="anchor-link" href="#Special-thanks-to-Ayush-Kaushal;-an-exemplary-mentor-without-whom-this-task-wouldn't-be-possible."> </a></h4><p>Find below, the <code>julia</code> part of the task. The python notebook would be attached too but would have sparse documentation.</p>
<blockquote><p>The process of algorithmically identifying and categorizing opinions expressed in text to determine the user’s attitude toward the subject of the document (or post).</p>
</blockquote>
<p>This is how I understand it.</p>
<h2 id="Importing-Required-Packages">Importing Required Packages<a class="anchor-link" href="#Importing-Required-Packages"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">using</span> <span class="n">TextAnalysis</span><span class="p">,</span> <span class="n">FileIO</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I would be working on the test data since the train one is <strong>humongous</strong> and my laptop was unable to render that in Jupyter every single time even when left for about an hour.</p>
<p>So, declaring the test reviews as <code>review</code> as evident by the code below.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">reviews</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span><span class="s2">&quot;text/test.ft.txt&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>FileDocument(&#34;text/test.ft.txt&#34;, TextAnalysis.DocumentMetadata(Languages.English(), &#34;text/test.ft.txt&#34;, &#34;Unknown Author&#34;, &#34;Unknown Time&#34;))</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Getting to know some of our data.</p>
<p>We can see that the <code>.txt</code> file contains reviews in the form of :</p>
<p>"<strong><strong>label</strong>1(/2)</strong> <em>space</em> <strong>...the review...</strong>"</p>
<p>Exploratory data analysis also reveals that reviews beginning with <code>__label__2</code> are positive reviews. That means that their sentiment score would also be higher (I'll demonstrate that in a sec...)
Similarly, reviews beginning with <code>__label__1</code> are negative reviews and so their sentiment score should evidently be lower.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Getting-our-pre-trained-Sentiment-Analyser-to-check-on-these-lines.">Getting our pre-trained Sentiment Analyser to check on these lines.<a class="anchor-link" href="#Getting-our-pre-trained-Sentiment-Analyser-to-check-on-these-lines."> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sent</span> <span class="o">=</span> <span class="n">SentimentAnalyzer</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>┌ Info: CUDAdrv.jl failed to initialize, GPU functionality unavailable (set JULIA_CUDA_SILENT or JULIA_CUDA_VERBOSE to silence or expand this message)
└ @ CUDAdrv C:\Users\shekh\.julia\packages\CUDAdrv\3EzC1\src\CUDAdrv.jl:69
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Sentiment Analysis Model Trained on IMDB with a 88587 word corpus</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#seeing how the data is arranged.</span>
<span class="n">readlines</span><span class="p">(</span><span class="s2">&quot;text/test.ft.txt&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>3-element Array{String,1}:
 &#34;__label__2 Great CD: My lovely Pat has one of the GREAT voices of her generation. I have listened to this CD for YEARS and I still LOVE IT. When I&#39;m in a good mood it makes me feel better. A bad mood just evaporates like sugar in the rain. This CD just oozes LIFE. Vocals are jusat STUUNNING and lyrics just kill. One of life&#39;s hidden gems. This is a desert isle CD in my book. Why she never made it big is just beyond me. Everytime I play this, no matter black, white, young, old, male, female EVERYBODY says one thing \&#34;Who was that singing ?\&#34;&#34;                                                                                                                                                                                                                                                                                         
 &#34;__label__2 One of the best game music soundtracks - for a game I didn&#39;t really play: Despite the fact that I have only played a small portion of the game, the music I heard (plus the connection to Chrono Trigger which was great as well) led me to purchase the soundtrack, and it remains one of my favorite albums. There is an incredible mix of fun, epic, and emotional songs. Those sad and beautiful tracks I especially like, as there&#39;s not too many of those kinds of songs in my other video game soundtracks. I must admit that one of the songs (Life-A Distant Promise) has brought tears to my eyes on many occasions.My one complaint about this soundtrack is that they use guitar fretting effects in many of the songs, which I find distracting. But even if those weren&#39;t included I would still consider the collection worth it.&#34;
 &#34;__label__1 Batteries died within a year ...: I bought this charger in Jul 2003 and it worked OK for a while. The design is nice and convenient. However, after about a year, the batteries would not hold a charge. Might as well just get alkaline disposables, or look elsewhere for a charger that comes with batteries that have better staying power.&#34;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 </pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now, I'll see that for the first 10 reviews in our dataset, what the actual label is and what sentiment score does our model return. From this we'll be able to know that the model isn't perfect and does indeed predict wrong sentiments for some reviews. Thus, developing a need to do text pre-processing to make the reviews comparable and remove unnecessary stuff like urls and other things generally not contributing to the <em>read/feel</em> of the review. !</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tab</span> <span class="o">=</span> <span class="s2">&quot;SNo. |  Label  | Prediction Score | Should be |  Predicted  | Correct/Incorrect  &quot;</span>
<span class="n">println</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="o">^</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span><span class="o">+</span><span class="mi">5</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="mi">1</span><span class="p">:</span><span class="mi">15</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">readlines</span><span class="p">(</span><span class="s2">&quot;text/test.ft.txt&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">];</span>
    <span class="n">review</span> <span class="o">=</span> <span class="n">readlines</span><span class="p">(</span><span class="s2">&quot;text/test.ft.txt&quot;</span><span class="p">)[</span><span class="n">i</span><span class="p">][</span><span class="mi">11</span><span class="p">:</span><span class="n">end</span><span class="p">];</span>
    <span class="n">review</span> <span class="o">=</span> <span class="n">StringDocument</span><span class="p">(</span><span class="n">review</span><span class="p">);</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">sent</span><span class="p">(</span><span class="n">review</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;__label__2&quot;</span>
        <span class="n">should_be</span> <span class="o">=</span> <span class="s2">&quot;+ve&quot;</span>
    <span class="k">else</span>
        <span class="n">should_be</span> <span class="o">=</span> <span class="s2">&quot;-ve&quot;</span>
    <span class="n">end</span>
    <span class="k">if</span> <span class="n">pred</span> <span class="o">&gt;=</span> <span class="mf">0.5</span>
        <span class="n">pred_be</span> <span class="o">=</span> <span class="s2">&quot;+ve&quot;</span>
    <span class="n">elseif</span> <span class="n">pred</span> <span class="o">&lt;</span> <span class="mf">0.5</span>
        <span class="n">pred_be</span> <span class="o">=</span> <span class="s2">&quot;-ve&quot;</span>
    <span class="n">end</span>
    <span class="k">if</span> <span class="n">pred_be</span> <span class="o">==</span> <span class="n">should_be</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="s2">&quot;Correct&quot;</span>
    <span class="k">else</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="s2">&quot;Incorrect&quot;</span>
    <span class="n">end</span>
    <span class="n">println</span><span class="p">(</span><span class="s2">&quot;$i   | $label  | $pred  |  $should_be  |  $pred_be | $correct  &quot;</span><span class="p">)</span>
<span class="n">end</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>SNo. |  Label  | Prediction Score | Should be |  Predicted  | Correct/Incorrect  
--------------------------------------------------------------------------------------
1   | __label__2  | 0.39506337  |  +ve  |  -ve | Incorrect  
2   | __label__2  | 0.5314957  |  +ve  |  +ve | Correct  
3   | __label__1  | 0.52432084  |  -ve  |  +ve | Incorrect  
4   | __label__2  | 0.5501878  |  +ve  |  +ve | Correct  
5   | __label__2  | 0.5919624  |  +ve  |  +ve | Correct  
6   | __label__1  | 0.61544746  |  -ve  |  +ve | Incorrect  
7   | __label__1  | 0.732198  |  -ve  |  +ve | Incorrect  
8   | __label__1  | 0.55473757  |  -ve  |  +ve | Incorrect  
9   | __label__2  | 0.4127747  |  +ve  |  -ve | Incorrect  
10   | __label__1  | 0.58470565  |  -ve  |  +ve | Incorrect  
11   | __label__2  | 0.5855292  |  +ve  |  +ve | Correct  
12   | __label__1  | 0.51694876  |  -ve  |  +ve | Incorrect  
13   | __label__1  | 0.5547061  |  -ve  |  +ve | Incorrect  
14   | __label__2  | 0.45876318  |  +ve  |  -ve | Incorrect  
15   | __label__1  | 0.52366424  |  -ve  |  +ve | Incorrect  
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It's clear that our model isn't optimal since out of 15 samples, only <strong>4</strong> were correct predictions. However, I went a little too harsh on the model since in some cases, like in</p>
<p><code>14   | __label__2  | 0.45876318  |  +ve  |  -ve | Incorrect</code></p>
<p>the model was within some limit of correct predictions. So yeah, sorry Mr. Sentiment Analyzer.</p>
<p>Moving on towards trying to improve the accuracy of predcitions by performing some general pre-defined text-processing functions in TextAnalysis package. But first, I want to know the length of our test data set so I can make batches of processing accrodinly to my computational powers.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_data</span> <span class="o">=</span> <span class="n">readlines</span><span class="p">(</span><span class="s2">&quot;text/test.ft.txt&quot;</span><span class="p">)</span>
<span class="n">length</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>400000</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ok, so now we know the size of the data we're dealing with let's get started with the pre-processing.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A true positive is an outcome where the model correctly predicts the positive class. Similarly, a true negative is an outcome where the model correctly predicts the negative class.</p>
<p>A false positive is an outcome where the model incorrectly predicts the positive class. And a false negative is an outcome where the model incorrectly predicts the negative class.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_labels</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">test_string</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">fal_pos</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">fal_neg</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">tru_pos</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">tru_neg</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="mi">1</span><span class="p">:</span><span class="n">length</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span><span class="n">test_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">10</span><span class="p">];</span>
    <span class="n">push</span><span class="o">!(</span>test_labels, label<span class="o">)</span><span class="p">;</span>
    <span class="n">review</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">11</span><span class="p">:</span><span class="n">end</span><span class="p">];</span>
    <span class="n">push</span><span class="o">!(</span>test_string, review<span class="o">)</span>
    <span class="c1">#after adding reviews and labels in their respective arrays.</span>
    <span class="c1">#I&#39;ll perform pre-processing on individual reviews.</span>
    <span class="n">review_sd</span> <span class="o">=</span> <span class="n">StringDocument</span><span class="p">(</span><span class="n">review</span><span class="p">)</span>
    
    <span class="n">remove_corrupt_utf8</span><span class="o">!(</span>review_sd<span class="o">)</span>
    <span class="n">stem</span><span class="o">!(</span>review_sd<span class="o">)</span>
    <span class="n">remove_case</span><span class="o">!(</span>review_sd<span class="o">)</span>
    <span class="c1">#remove_indefinite_articles!(review_sd)</span>
    <span class="c1">#remove_definite_articles!(review_sd)</span>
    
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;__label__2&quot;</span>
        <span class="n">should_be</span> <span class="o">=</span> <span class="s2">&quot;+ve&quot;</span>
    <span class="k">else</span>
        <span class="n">should_be</span> <span class="o">=</span> <span class="s2">&quot;-ve&quot;</span>
    <span class="n">end</span>
    
    <span class="n">pred</span> <span class="o">=</span> <span class="n">sent</span><span class="p">(</span><span class="n">review_sd</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">pred</span> <span class="o">&gt;=</span> <span class="mf">0.5</span>
        <span class="n">pred_be</span> <span class="o">=</span> <span class="s2">&quot;+ve&quot;</span>
    <span class="n">elseif</span> <span class="n">pred</span> <span class="o">&lt;</span> <span class="mf">0.5</span>
        <span class="n">pred_be</span> <span class="o">=</span> <span class="s2">&quot;-ve&quot;</span>
    <span class="n">end</span>
    
    <span class="k">if</span> <span class="n">pred_be</span> <span class="o">==</span> <span class="s2">&quot;+ve&quot;</span> <span class="o">&amp;&amp;</span> <span class="n">should_be</span> <span class="o">==</span> <span class="s2">&quot;+ve&quot;</span>
        <span class="n">tru_pos</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">elseif</span> <span class="n">pred_be</span> <span class="o">==</span> <span class="s2">&quot;-ve&quot;</span> <span class="o">&amp;&amp;</span> <span class="n">should_be</span> <span class="o">==</span> <span class="s2">&quot;-ve&quot;</span>
        <span class="n">tru_neg</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">elseif</span> <span class="n">pred_be</span> <span class="o">==</span> <span class="s2">&quot;-ve&quot;</span> <span class="o">&amp;&amp;</span> <span class="n">should_be</span> <span class="o">==</span> <span class="s2">&quot;+ve&quot;</span>
        <span class="n">fal_pos</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">elseif</span> <span class="n">pred_be</span> <span class="o">==</span> <span class="s2">&quot;+ve&quot;</span> <span class="o">&amp;&amp;</span> <span class="n">should_be</span> <span class="o">==</span> <span class="s2">&quot;-ve&quot;</span>
        <span class="n">fal_neg</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">end</span>
    
<span class="n">end</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
BoundsError: attempt to access 32×5000 Array{Float32,2} at index [Base.Slice(Base.OneTo(32)), 5001]

Stacktrace:
 [1] throw_boundserror(::Array{Float32,2}, ::Tuple{Base.Slice{Base.OneTo{Int64}},Int64}) at .\abstractarray.jl:538
 [2] checkbounds at .\abstractarray.jl:503 [inlined]
 [3] _getindex at .\multidimensional.jl:669 [inlined]
 [4] getindex at .\abstractarray.jl:981 [inlined]
 [5] embedding(::Array{Float32,2}, ::Array{Float64,1}) at C:\Users\shekh\.julia\packages\TextAnalysis\pcFQf\src\sentiment.jl:27
 [6] (::TextAnalysis.var&#34;#24#25&#34;{Dict{Symbol,Any}})(::Array{Float64,1}) at C:\Users\shekh\.julia\packages\TextAnalysis\pcFQf\src\sentiment.jl:40
 [7] get_sentiment(::TextAnalysis.var&#34;#26#27&#34;, ::Array{String,1}, ::Dict{Symbol,Any}, ::Dict{String,Any}) at C:\Users\shekh\.julia\packages\TextAnalysis\pcFQf\src\sentiment.jl:59
 [8] (::TextAnalysis.SentimentModel)(::Function, ::Array{String,1}) at C:\Users\shekh\.julia\packages\TextAnalysis\pcFQf\src\sentiment.jl:87
 [9] SentimentAnalyzer at C:\Users\shekh\.julia\packages\TextAnalysis\pcFQf\src\sentiment.jl:103 [inlined] (repeats 2 times)
 [10] top-level scope at .\In[33]:28</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ahh! Finally it's complete.</p>
<p>We get <code>BoundsError: attempt to access 32×5000 Array{Float32,2} at index [Base.Slice(Base.OneTo(32)), 5001]</code> error however on seeing this issue on TextAnalysis package.</p>
<blockquote><p>Ref:<a href="https://github.com/JuliaText/TextAnalysis.jl/issues/160">BoundsError in sentiment analysis</a>
I've decided to ignore it. Let's get on towards calculating our predictions metrices: Precision / F1Score / Recall.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>
$$P = \frac{T_p}{T_p+F_p}$$
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>
$$R = \frac{T_p}{T_p + F_n}$$
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>
$$ F1 = \frac{2 \cdot P\cdot R}{P+ R} $$
</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Precision">Precision<a class="anchor-link" href="#Precision"> </a></h3>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">precision</span> <span class="o">=</span> <span class="n">tru_pos</span> <span class="o">/</span> <span class="p">(</span><span class="n">tru_pos</span> <span class="o">+</span> <span class="n">fal_pos</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="s2">&quot;Precision is $precision&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Precision is 0.583117838593833
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">recall</span> <span class="o">=</span> <span class="n">tru_pos</span> <span class="o">/</span> <span class="p">(</span><span class="n">tru_pos</span> <span class="o">+</span> <span class="n">fal_neg</span><span class="p">)</span>
<span class="n">println</span><span class="p">(</span><span class="s2">&quot;Recall is $recall&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Recall is 0.5144996465068449
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f1score</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">precision</span> <span class="o">*</span> <span class="n">recall</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">precision</span> <span class="o">+</span> <span class="n">recall</span><span class="p">)</span>
<span class="c1">#f1score is from 0 --&gt; 1</span>
<span class="n">println</span><span class="p">(</span><span class="s2">&quot;F1Score is $f1score.&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>F1Score is 0.5466638895622987.
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="End-of-Report">End of Report<a class="anchor-link" href="#End-of-Report"> </a></h2>
</div>
</div>
</div>
</div>



  </div><a class="u-url" href="/julia/ml/gci19/2020/01/14/Sentiment-Analysis-with-TextAnalysis(jl).html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>All my activities and experiences in one place-mostly ML stuff.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/pseudocodenerd" title="pseudocodenerd"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/sharmadhav03" title="sharmadhav03"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
